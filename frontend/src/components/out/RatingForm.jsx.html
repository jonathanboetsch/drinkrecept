<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: RatingForm.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: RatingForm.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Star from "./Star.jsx";
import "./Rating.css";
import { useEffect, useState } from "react";
import { useRecipesContext } from "./RecipesContext.jsx";
import Recipe from "./Recipe.jsx";
import PropTypes from "prop-types";

/**
 * RatingForm component allows users to rate a recipe and displays the rating stars.
 * It handles user interactions, updates the average rating, and manages the user's rating state.
 *
 * @component
 * @param {Object} props - The props object.
 * @param {number[]} [props.ratingLevels=[1, 2, 3, 4, 5]] - Array of rating levels to display as stars.
 * @param {Function} props.confirmationAction - Callback function to handle confirmation actions.
 * @param {Object} props.recipe - The recipe object for which the rating is being submitted.
 * @param {string} props.recipe._id - The unique identifier of the recipe.
 *
 * @returns {JSX.Element} The rendered RatingForm component.
 *
 * @example
 * &lt;RatingForm
 *   ratingLevels={[1, 2, 3, 4, 5]}
 *   confirmationAction={() => console.log("Rating confirmed!")}
 *   recipe={{ _id: "12345" }}
 * />
 */
export default function RatingForm({ ratingLevels = [1, 2, 3, 4, 5], confirmationAction, recipe }) {
  const [userRating, setUserRating] = useState(null);
  const [ratingDisabled, setRatingDisabled] = useState(false);
  const [feedbackMessageOn, setFeedbackMessageOn] = useState(false);

  const { updateAvgRating, updateUserRatings, userRatings } = useRecipesContext();

  useEffect(() => {
    if (!userRatings?.length) return;
    const found = userRatings?.find((r) => r.recipeId === recipe._id)?.rating ?? null;
    setUserRating(found);
    setRatingDisabled(found !== null);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [userRatings]);

  const handleRatingClick = (rating) => {
    if (ratingDisabled) return; // guard against double-clicks
    setRatingDisabled(true); // instant disable
    setUserRating(rating); // optional optimistic UI update
    setFeedbackMessageOn(true);
    setTimeout(() => setFeedbackMessageOn(false), 2000);

    const API_URL = "https://grupp3-jynxa.reky.se";
    const POST_RATING_URI = `/recipes/${recipe._id}/ratings`;
    const GET_URI = `/recipes/${recipe._id}`;

    if (recipe._id &amp;&amp; rating !== null) {
      fetch(`${API_URL}${POST_RATING_URI}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ rating }),
      })
        .then((res) => {
          if (!res.ok) throw new Error("Failed to submit rating");
          return fetch(`${API_URL}${GET_URI}`);
        })
        .then((res2) => {
          if (!res2.ok) throw new Error("Failed to fetch the recipe for avgRating update");
          return res2.json();
        })
        .then((updatedRecipe) => {
          const newAvgRating = Number(updatedRecipe.avgRating);
          updateAvgRating(recipe._id, newAvgRating);
          updateUserRatings(recipe._id, rating);
        })
        .catch((error) => console.error(error));
    }
  };

  return (
    &lt;div className="rating-form">
      &lt;div className="stars">
        {ratingLevels.map((val) => (
          &lt;Star
            key={val}
            level={val} // each Star gets an increasing rating value
            confAction={confirmationAction} // thought to popup a "thank for your contribution"
            onRating={handleRatingClick} // user click on Star => set its rating value in the RatingForm
            recipe={recipe} // optional, put here for logging in the console when user clicks
            isHidden={ratingDisabled} // Star can this way update its css property dynamically
            imageUrl={
              userRating === null || val &lt;= userRating
                ? "https://upload.wikimedia.org/wikipedia/commons/6/6e/Super_Mario_Bros._%E2%80%93_Overworld_Star.png"
                : "https://cdn3.iconfinder.com/data/icons/wpzoom-developer-icon-set/500/118-1024.png"
            }
          />
        ))}
      &lt;/div>
      &lt;div className="feedback-message">{feedbackMessageOn &amp;&amp; &lt;p>Tack för din röst !!! &lt;/p>}&lt;/div>
    &lt;/div>
  );
}

RatingForm.propTypes = {
  ratingLevels: PropTypes.arrayOf(Number),
  confirmationAction: PropTypes.func.isRequired,
  recipe: PropTypes.shape(Recipe.propTypes),
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#App">App</a></li><li><a href="global.html#useRecipesContext">useRecipesContext</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Sun Nov 09 2025 15:35:42 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
